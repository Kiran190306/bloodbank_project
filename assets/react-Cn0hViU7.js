var I=Object.defineProperty;var L=(e,n,t)=>n in e?I(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t;var x=(e,n,t)=>L(e,typeof n!="symbol"?n+"":n,t);import{r as d}from"./chunk-JMJ3UQ3L-NvGUjwXk.js";if(typeof window<"u"){const e={};globalThis.process??(globalThis.process={});const n=globalThis.process.env??{};globalThis.process.env=new Proxy(Object.assign({},e,n),{get(t,s){return s in t?t[s]:void 0},has(){return!0}})}class i extends Error{constructor(n,t){var o;n instanceof Error?super(void 0,{cause:{err:n,...n.cause,...t}}):typeof n=="string"?(t instanceof Error&&(t={err:t,...t.cause}),super(n,t)):super(void 0,n),this.name=this.constructor.name,this.type=this.constructor.type??"AuthError",this.kind=this.constructor.kind??"error",(o=Error.captureStackTrace)==null||o.call(Error,this,this.constructor);const s=`https://errors.authjs.dev#${this.type.toLowerCase()}`;this.message+=`${this.message?". ":""}Read more at ${s}`}}class h extends i{}h.kind="signIn";class T extends i{}T.type="AdapterError";class R extends i{}R.type="AccessDenied";class M extends i{}M.type="CallbackRouteError";class O extends i{}O.type="ErrorPageLoop";class D extends i{}D.type="EventError";class N extends i{}N.type="InvalidCallbackUrl";class W extends h{constructor(){super(...arguments),this.code="credentials"}}W.type="CredentialsSignin";class j extends i{}j.type="InvalidEndpoints";class V extends i{}V.type="InvalidCheck";class z extends i{}z.type="JWTSessionError";class F extends i{}F.type="MissingAdapter";class J extends i{}J.type="MissingAdapterMethods";class H extends i{}H.type="MissingAuthorize";class X extends i{}X.type="MissingSecret";class B extends h{}B.type="OAuthAccountNotLinked";class G extends h{}G.type="OAuthCallbackError";class K extends i{}K.type="OAuthProfileParseError";class Q extends i{}Q.type="SessionTokenError";class Y extends h{}Y.type="OAuthSignInError";class Z extends h{}Z.type="EmailSignInError";class _ extends i{}_.type="SignOutError";class q extends i{}q.type="UnknownAction";class ee extends i{}ee.type="UnsupportedStrategy";class te extends i{}te.type="InvalidProvider";class ne extends i{}ne.type="UntrustedHost";class se extends i{}se.type="Verification";class ie extends h{}ie.type="MissingCSRF";class oe extends i{}oe.type="DuplicateConditionalUI";class re extends i{}re.type="MissingWebAuthnAutocomplete";class ae extends i{}ae.type="WebAuthnVerificationError";class ce extends h{}ce.type="AccountNotLinked";class le extends i{}le.type="ExperimentalFeatureNotEnabled";if(typeof window<"u"){const e={};globalThis.process??(globalThis.process={});const n=globalThis.process.env??{};globalThis.process.env=new Proxy(Object.assign({},e,n),{get(t,s){return s in t?t[s]:void 0},has(){return!0}})}var de=class extends i{},ue=class extends i{};async function C(e,n,t,s={}){var c;const o=`${n.baseUrl}${n.basePath}/${e}`;try{const r={headers:{"Content-Type":"application/json",...(c=s==null?void 0:s.headers)!=null&&c.cookie?{cookie:s.headers.cookie}:{}},credentials:n.credentials};s!=null&&s.body&&(r.body=JSON.stringify(s.body),r.method="POST");const l=await fetch(o,r),a=await l.json();if(!l.ok)throw a;return a}catch(r){return t.error(new de(r.message,r)),null}}function fe(){const[e,n]=d.useState(typeof navigator<"u"?navigator.onLine:!1);return d.useEffect(()=>{const t=new AbortController,{signal:s}=t,o=()=>{n(!0)},c=()=>{n(!1)};return window.addEventListener("online",o,{signal:s}),window.addEventListener("offline",c,{signal:s}),()=>{t.abort()}},[]),e}function S(){return Math.floor(Date.now()/1e3)}function P(e){const n="http://localhost:3000/api/auth",t=new URL(e?e.startsWith("http")?e:`https://${e}`:n),s=t.pathname==="/"?"/api/auth":t.pathname.replace(/\/$/,""),o=`${t.origin}${s}`;return{origin:t.origin,host:t.host,path:s,base:o,toString:()=>o}}var y={debug:console.debug,error:console.error,warn:console.warn},u,he=(u=class{constructor(){x(this,"config");this.config=this.createDefaultConfig()}createDefaultConfig(){return{baseUrl:typeof window<"u"?P(window.location.origin).origin:"",basePath:typeof window<"u"?P(window.location.origin).path:"/api/auth",credentials:"same-origin",lastSync:0,session:null,fetchSession:async()=>{}}}static getInstance(){return u.instance||(u.instance=new u),u.instance}setConfig(n){this.config={...this.config,...n}}getConfig(){return this.config}initializeConfig(n){this.config.lastSync=n?S():0}},x(u,"instance",null),u),f=he.getInstance(),E=d.createContext(void 0);function ge(e,n){const t=f.getConfig(),[s,o]=d.useState(n),[c,r]=d.useState(!e);return d.useEffect(()=>(t.fetchSession=async({event:l}={})=>{try{if(l==="storage"||!t.session){t.lastSync=S(),t.session=await $(),o(t.session);return}if(!l||!t.session||S()<t.lastSync)return;t.lastSync=S(),t.session=await $(),o(t.session)}catch(a){y.error(new ue(a.message,a))}finally{r(!1)}},t.fetchSession(),()=>{t.lastSync=0,t.session=null,t.fetchSession=async()=>{}}),[]),{session:s,setSession:o,loading:c,setLoading:r}}function pe(e,n){d.useEffect(()=>{const t=new AbortController,s=()=>{n&&document.visibilityState==="visible"&&e.fetchSession({event:"visibilitychange"})};return document.addEventListener("visibilitychange",s,{signal:t.signal}),()=>{t.abort()}},[n])}function we(e,n,t){d.useEffect(()=>{if(n&&t){const s=setInterval(()=>{e.session&&e.fetchSession({event:"poll"})},n*1e3);return()=>{clearInterval(s)}}},[n,t])}async function $(e){const{baseUrl:n,basePath:t,credentials:s}=f.getConfig();return await C("session",{baseUrl:n,basePath:t,credentials:s},y,e)}async function A(){const{baseUrl:e,basePath:n,credentials:t}=f.getConfig(),s=await C("csrf",{baseUrl:e,basePath:n,credentials:t},y);return(s==null?void 0:s.csrfToken)??""}function Ee(e){if(!E)throw new Error("React Context is unavailable in Server Components");const{children:n,refetchInterval:t,refetchWhenOffline:s=!0}=e,o=f.getConfig(),c=!!e.session;f.initializeConfig(c);const{session:r,setSession:l,loading:a,setLoading:b}=ge(c,e.session??null);pe(o,e.refetchOnWindowFocus??!0);const v=fe();we(o,t,s||v);const g=d.useMemo(()=>({data:r,status:a?"loading":r?"authenticated":"unauthenticated",update:async p=>{if(a||!r)return;b(!0);const w=await C("session",o,y,p?{body:{csrfToken:await A(),data:p}}:void 0);return b(!1),w&&l(w),w}}),[r,a,l]);return d.createElement(E.Provider,{value:g},n)}function Ce(e){if(!E)throw new Error("React Context is unavailable in Server Components");const n=f.getConfig(),t=d.useContext(E),{required:s,onUnauthenticated:o}={},c=s&&(t==null?void 0:t.status)==="unauthenticated";return d.useEffect(()=>{if(c){const r=`${n.baseUrl}${n.basePath}/signin?${new URLSearchParams({error:"SessionRequired",callbackUrl:window.location.href})}`;o?o():window.location.href=r}},[c,o]),c?{data:t==null?void 0:t.data,update:t==null?void 0:t.update,status:"loading"}:t}async function ye(){return C("providers",f.getConfig(),y)}async function ve(e,n={},t={}){var m;const{callbackUrl:s=window.location.href,redirect:o=!0,...c}=n,r=f.getConfig(),l=`${r.baseUrl}${r.basePath}`,a=await ye();if(!a){window.location.href=`${l}/error`;return}if(!e||!(e in a)){window.location.href=`${l}/signin?${new URLSearchParams({callbackUrl:s})}`;return}const b=a[e].type==="credentials";a[e].type;const v=`${l}/${b?"callback":"signin"}/${e}`,k=await A(),g=await fetch(`${v}?${new URLSearchParams(t)}`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Auth-Return-Redirect":"1"},body:new URLSearchParams({...c,csrfToken:k,callbackUrl:s}),credentials:r.credentials}),p=await g.json();if(o){const U=p.url??s;window.location.href=U,U.includes("#")&&window.location.reload();return}const w=new URL(p.url).searchParams.get("error");return g.ok&&await((m=r.fetchSession)==null?void 0:m.call(r,{event:"storage"})),{error:w,status:g.status,ok:g.ok,url:w?null:p.url}}async function xe(e){var l;const{callbackUrl:n=window.location.href,redirect:t=!0}=e??{},s=f.getConfig(),o=await A(),r=await(await fetch(`${s.baseUrl}${s.basePath}/signout`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Auth-Return-Redirect":"1"},body:new URLSearchParams({csrfToken:o,callbackUrl:n}),credentials:s.credentials})).json();if(t){const a=r.url??n;window.location.href=a,a.includes("#")&&window.location.reload();return}return await((l=s.fetchSession)==null?void 0:l.call(s,{event:"storage"})),r}export{Ee as S,xe as a,ve as s,Ce as u};
